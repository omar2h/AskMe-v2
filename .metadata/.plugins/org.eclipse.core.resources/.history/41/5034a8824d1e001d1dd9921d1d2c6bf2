/*
 * AppMainMenu.cpp
 *
 *  Created on: Aug 17, 2022
 *      Author: omarh
 */

#include "AppMainMenu.h"
#include "DBmanager.h"
#include "User.h"
#include "Question.h"


AppMainMenu::AppMainMenu() {
	// TODO Auto-generated constructor stub

}

AppMainMenu::~AppMainMenu() {
	// TODO Auto-generated destructor stub
}

void AppMainMenu::run(int choice, User& user){
	if(choice == PRINT_QUESTIONS_RECEIVED){
		print_questions_received(user.getId());
	}
	else if(choice == PRINT_QUESTIONS_ASKED){
		print_questions_asked(user.getId());
	}
}

void AppMainMenu::print_questions_received(const int uId){
	DBmanager DB;
	/* map variable to store questions where the id is the key and vector of questions beginning with the questions followed by its children if any */
	std::map<int, std::vector<Question>> mp;
	/* Fill the map with all question the user received */
	DB.get_Qs_to_user(uId, mp);

	for (auto &[key, val] : mp)
	{
		/* if is a parent question then print the children */
		if (val[0].getThreadId() == -1)
		{
			int spaces = 0;
			val[0].print();
			for (int i = 1; i < (int)val.size(); i++)
			{
				/* at each child question increase space by 2 to distinguish from parent question */
				print_children(mp[val[i].getId()], mp, spaces + 2);
			}
			std::cout << '\n';
		}
	}
}

void AppMainMenu::print_questions_asked(const int uId)
{
	DBmanager DB;
	/* vector variable to store questions user asked */
	std::vector<Question> qv;
	/* fill vector with questions asked only */
	DB.get_questions_from_user(uId, qv);

	// c++ 17 syntax
	for (auto &q : qv)
	{
		/* print question in an asked format */
		q.print_asked();
	}
}
